# Проектная работа "Веб-ларек"
Веб-ларёк - это онлайн магазин для необходимых мелочей веб-разработчик.

Ссылка на GitHub: https://github.com/KatyaVarentsova/web-larek-frontend

## Описание

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Архитектура приложения 
Код приложения организован по парадигме MVP (Model–View–Presenter), что позволяет разделить ответственность между слоями, упростить сопровождение и расширяемость проекта.

**Model**

Модель отвечает за:
- хранение данных (список продуктов, корзина, данные доставки и контактов, заказ),
- бизнес-логику (добавление/удаление товаров в корзину, подсчёт суммы, формирование тела заказа),
- подготовку данных для передачи на сервер или в представление.
Все вычисления и работа с состоянием происходят именно здесь.

**View**

Слой представления полностью сосредоточен на UI.
- Управляет DOM-узлами (карточки товаров, модальные окна, формы, корзина).
- Не содержит бизнес-логики.
- Отвечает только за то, чтобы красиво и правильно отобразить данные, которые ему передал Presenter.

Базовые классы (Component, Modal, Form) позволяют переиспользовать логику и обеспечивают единообразие во всех наследниках (ProductCard, ProductModal, BasketModal, DeliveryForm, ContactForm, ResultModal).

**Presenter**

- Подписывается на события, генерируемые UI-компонентами.
- Вызывает соответствующие методы моделей.
- Передаёт обновлённые данные во View.

Таким образом, Presenter избавляет View от лишней логики и управляет всем сценарием работы приложения.

**Реализация процессов**
Все процессы реализованы именно как event flow (поток событий):
1. Пользователь что-то делает (клик, ввод текста).
2. View генерирует событие.
3. Presenter ловит событие.
4. Presenter меняет Model или вызывает API.
5. Model обновляется, данные возвращаются во View.

### Model

#### Класс GlobalStore
Класс описывает состояние приложения и реализует интерфейс IGlobalStore. Является частью Model в архитектуре MVP.

**Свойства**
- products: IProduct[] — список всех доступных товаров.
- basketProducts: IProduct[] — список товаров, добавленных в корзину.
- delivery: IDelivery — данные о доставке (способ оплаты и адрес).
- contact: IContact — контактные данные (email и телефон).
- order: IOrder — объект текущего заказа.

**Методы работы с товарами**
- setProducts(products) — сохраняет список всех товаров.
- getBasketProducts() — возвращает товары в корзине.
- addBasketProducts(product) — добавляет товар в корзину.
- deleteBasketProducts(product) — удаляет товар из корзины.
- cleaningBasketProducts() — очищает корзину.
- isProductInBasket(product) — проверяет, есть ли товар в корзине.

**Методы для расчётов**
- orderAmount() — возвращает общую сумму товаров в корзине.
- orderCount() — возвращает количество товаров в корзине.
- allProductsID() — возвращает массив ID товаров из корзины.

**Методы для работы с заказом**
- setDelivery(delivery) — сохраняет данные доставки.
- getDelivery() — возвращает данные доставки.
- setContact(contact) — сохраняет контактные данные.
- getContact() — возвращает контактные данные.
- getOrder() — формирует объект заказа (IOrderRequestBody) с:
    - способом оплаты,
    - email и телефоном,
    - адресом доставки,
    - итоговой суммой,
    - списком ID товаров.

#### Типы 
Контракты для описания продуктов, корзины, доставки, контакта и заказа.
```TypeScript
interface IProduct {
    id: string,
    description: string,
    image: string,
    title: string,
    category: string,
    price: number
}
```

```TypeScript
interface IDelivery {
    payment: string,
    address: string,
}
```

```TypeScript
interface IContact {
    email: string,
    phone: string,
}
```

```TypeScript
interface IOrder extends IDelivery, IContact {
    total: number,
    items: string[]
}
```

#### Класс Api
Класс для работы с серверным API (универсальная обёртка над fetch).

**Свойства**
- baseUrl: string — базовый URL для запросов.
- options: RequestInit — настройки по умолчанию для fetch (например, заголовки).

**Методы**
- protected handleResponse(response) — обрабатывает ответ сервера.
- get(uri) — делает GET-запрос на baseUrl + uri и возвращает данные с сервера.
- post(uri, data, method = 'POST') — делает запрос POST | PUT | DELETE с JSON-телом и возвращает результат с сервера.

**Типы**

Для ответа Get-запроса:
```TypeScript
interface IGetProductsResponse {
    total: number,
    items: IProduct[],
}
```
Для ответа Post-запроса:
```TypeScript
interface IPostOrderResponse {
    id: string,
    total: number
}
```
Для запроса Post-запроса:
```TypeScript
interface IOrderRequestBody {
    payment: string,
    email: string,
    phone: string,
    address: string,
    total: number,
    items: string[]
}
```

### View 
Работает только с DOM и отображением. Никакой бизнес-логики, только UI.
#### Класс ViewManager
Управляет "глобальным" отображением (шапка, счетчик корзины, галерея).

**Свойства**
- headerNode: HTMLElement — DOM-элемент шапки сайта.
- galleryNode: HTMLElement — DOM-элемент контейнера для товаров.
- events: IEvents — объект для генерации событий (EventEmitter).

**Методы**
- constructor(headerSelector, gallerySelector, events) — находит элементы шапки и галереи в DOM, сохраняет объект событий и сразу подключает обработчик для корзины.
- renderProduct(elementNode: HTMLElement) — добавляет переданный товар (DOM-узел карточки продукта) в галерею.
- addEventBasket() — вешает обработчик на кнопку корзины в шапке.
- displayBasketCounter(orderCounte: number) — находит элемент счётчика товаров в корзине и обновляет его значение.

#### Компоненты:
##### Абстрактный класс Component
Базовый абстрактный класс для всех UI-компонентов.

**Свойства**
- element: HTMLElement — DOM-элемент компонента.
- events: IEvents — объект событий для коммуникации.

**Методы**
- constructor(events, elementsBlock) — инициализация компонента, создание элемента и навешивание слушателей.
- createElement(elementsBlock) — создаёт/возвращает DOM-узел (можно переопределять).
- addEventListeners() — подключает обработчики событий (переопределяется в наследниках).
- getElement() — возвращает текущий DOM-элемент компонента.

##### Абстрактный класс Modal
Абстрактный класс для модальных окон, наследуется от Component.

**Свойства**
- name: string — имя модалки, используется для формирования событий (${this.name}:close).

**Методы**
- addEventListeners() — вешает обработчики:
    - закрытие по кнопке .modal__close,
    - закрытие при клике на фон за пределами .modal__container.
- open() — открывает модалку
- close() — закрывает модалку

##### Абстрактный класс Form
Абстрактный класс для модальных форм, наследуется от Modal (слой View).

**Свойства**
- formElement: HTMLFormElement — сама форма внутри модалки.
- buttonForm: HTMLButtonElement — кнопка продолжения/отправки формы (инициализируется при рендере).
- errorElement: HTMLSpanElement — комментарий с ошибкой.

**Методы**
- constructor(elementsBlock, events) — вызывает конструктор Modal, инициализирует базовую структуру формы.
- eventsEmit() — абстрактный метод-заглушка, который должны переопределять наследники (определяет, какие события генерируются при отправке формы).
- addEventListeners() — добавляет обработчики:
    - вызывает super.addEventListeners() (закрытие модалки),
    - навешивает обработчик submit на форму, предотвращает перезагрузку страницы и вызывает eventsEmit().
- render() — находит кнопку формы (.button_further), изначально отключает её и открывает модалку.

##### Класс ProductCard
Класс для отображения карточки товара на странице. Наследуется от Component.

**Свойства**
- id, title, description, category, image, price — данные конкретного товара.
- element (унаследовано от Component) — DOM-узел карточки.
- events (унаследовано от Component) — объект для работы с событиями.

**Методы**
- constructor(...) — принимает данные о товаре, вызывает родительский конструктор и сразу рендерит карточку.
- render() — заполняет DOM-элемент карточки:
    - устанавливает категорию с классом из categoryMap,
    - задаёт заголовок, изображение и цену (синапсы или Бесценно).
- addEventListeners() — вешает обработчик клика по карточке и генерирует событие card:click, передавая сам объект карточки.

##### Класс ProductModal
Модальное окно для отображения информации о товаре и добавления/удаления его из корзины. Наследуется от Modal (слой View).

**Свойства**
- productButtonHandler? — текущий обработчик кнопки (добавления/удаления из корзины), чтобы можно было снимать старый при переключении.
- name (унаследовано от Modal) — имя модалки для генерации событий (${name}:close).
- element (унаследовано от Component) — DOM-элемент модалки.
- events (унаследовано) — эмиттер событий для связи с Presenter.

**Методы**
- constructor(elementsBlock, events, name) — вызывает конструктор Modal, сохраняет имя модалки.
- render(product, isProductInBasket) — заполняет DOM:
    - ставит картинку, категорию (с CSS-классом из categoryMap), заголовок, описание, цену.
    - если у товара есть цена: кнопка активна → либо «Убрать», либо «В корзину» (в зависимости от того, в корзине товар или нет).
    - если цена отсутствует → пишет «Бесценно», кнопка «Не продаётся» (disabled).
    - в конце открывает модалку (this.open()).
- removeHandler(btn) — снимает старый обработчик клика с кнопки, если он был.
- setAddHandler(btn, product) — назначает обработчик:
    - эмитит событие product:put,
    - переключает кнопку на «Убрать»,
    - закрывает модалку.
- setDeleteHandler(btn, product) — назначает обработчик:
    - эмитит событие product:delete,
    - переключает кнопку на «В корзину»,
    - закрывает модалку.

##### Класс BasketModal
Модальное окно корзины. Наследуется от Modal.

**Свойства**
- name (унаследовано) — имя модалки для событий (${name}:close).
- element (унаследовано) — DOM-элемент корзины.
- events (унаследовано) — эмиттер событий для связи с Presenter.

**Методы**
- constructor(elementsBlock, events, name) — вызывает конструктор Modal, сохраняет имя.
- addEventListeners() — добавляет обработчик кнопки «Оформить заказ» → эмитит событие delivery:open.
- addRemoveListeners(btn, product) (приватный) — добавляет обработчик удаления товара → эмитит basket:delete.
- render(products, orderAmount):
    - очищает список товаров,
    - если корзина не пустая → строит список товаров (<li> с индексом, названием, ценой и кнопкой удаления), добавляет слушатели для кнопок, показывает блок действий и общую сумму,
    - если пустая → скрывает блок действ

##### Класс DeliveryForm
Класс формы доставки. Наследуется от Form и отвечает за ввод адреса и выбор способа оплаты.

**Свойства**
- delivery: IDelivery — объект с данными доставки:
    - payment — способ оплаты ('online' или 'cash'),
    - address — строка адреса.
- name (унаследовано) — имя модалки.
- formElement, buttonForm (унаследовано) — DOM-форма и кнопка «Далее».
- events (унаследовано) — эмиттер событий для связи с Presenter.

**Методы**
- constructor(elementsBlock, events, name) — вызывает Form, задаёт name, инициализирует delivery пустыми значениями.
- eventsEmit() — готовые эмиты событий при успешной отправки формы.
- addEventListeners() — подключает базовые слушатели из Form.
- updateButtonState() — активирует/деактивирует кнопку «Далее», если заполнены и адрес, и оплата.
- selectionButtons() — вешает обработчики на кнопки выбора оплаты («Онлайн» / «Наличными»).
- isValidRussianString(str, input) — проверяет, что адрес введён кириллицей и допустимыми символами.
- inputAddresses() — навешивает обработчики на поле адреса
- render() — вызывает базовый render() из Form, обновляет состояние кнопки.

##### Класс ContactForm
Класс формы для ввода контактных данных (email и телефон).
Наследуется от Form и отвечает за валидацию + сбор контактной информации.

**Свойства**
- contact: IContact — объект с контактными данными:
    - email — строка e-mail,
    - phone — строка телефона.
- name (унаследовано) — имя модалки.
- formElement, buttonForm (унаследовано) — DOM-форма и кнопка «Далее».
- events (унаследовано) — эмиттер событий для связи с Presenter.

**Методы**
- constructor(elementsBlock, events, name) — вызывает конструктор Form, задаёт name, инициализирует пустой contact.
- eventsEmit() — отправляет событие contact:save с объектом contact.
- addEventListeners() — подключает базовые слушатели из Form.
- updateButtonState() — делает кнопку «Далее» активной только если оба поля заполнены.
- isValidateEmail(email, input) — проверяет корректность email по regex.
- inputEmail():
    - при blur проверяет email и сохраняет его в contact.email.
    - при input очищает ошибки и сбрасывает подсветку.
- inputPhone():
    - форматирует ввод в российский номер (+7 (xxx) xxx-xx-xx).
    - сохраняет результат в contact.phone.
    - при blur проверяет длину и выводит ошибку, если номер некорректный.
- render() — вызывает базовый render() из Form, обновляет состояние кнопки.

##### Класс ResultModal
Класс ResultModal — это финальная модалка, показывающая результат заказа.
Наследуется от Modal и служит для отображения информации о списанных «синапсах».

**Свойства**
- name (унаследовано) — имя модального окна.
- events (унаследовано) — система событий для связи с Presenter.
- element (унаследовано) — DOM-узел модалки.

**Методы**
- constructor(elementsBlock, events, name) — вызывает конструктор Modal, задаёт имя модалки.
- addEventListeners() — дополняет базовые слушатели.
- render(orderAmount: number) — отрисовывет результирующую модалку.


### Presenter
Посредник между Model и View — index.ts.
Подписывается на события View, вызывает методы Model, а затем обновляет View.
#### Класс EventEmitter
**Свойства**
- _events: Map<EventName, Set<Subscriber>> — хранилище всех событий

**Методы**
- on(eventName, callback) — подписывает обработчик на событие.
- off(eventName, callback) — удаляет обработчик для события.
- emit(eventName, data?) — вызывает всех подписчиков для события.
- onAll(callback) — подписка на все события (обёртка над on("*", callback)).
- offAll() — полностью очищает все подписки.
- trigger(eventName, context?) — возвращает функцию, которая при вызове автоматически вызывает emit.

#### Описание событий 
- card:click — открыть карточку товара.
- card:close — закрыть карточку товара.
- product:put — добавить товар в корзину.
- product:delete — удалить товар из корзины (через карточку).
- basket:open — открыть корзину.
- basket:close — закрыть корзину.
- basket:delete — удалить товар из корзины (через корзину).
- delivery:open — открыть форму доставки.
- delivery:close — закрыть форму доставки.
- delivery:save — сохранить данные доставки.
- contact:open — открыть форму контактов.
- contact:close — закрыть форму контактов.
- contact:save — сохранить контакты.
- result:open — открыть модалку успешного заказа.
- result:close — закрыть модалку успешного заказа.
